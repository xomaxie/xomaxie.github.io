<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>FEDoc - Farming Game Engine Documentation</title>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; margin: 2rem; color: #1a1a1a; }
    h1, h2, h3 { color: #1565c0; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 2rem; }
    th, td { border: 1px solid #bbb; padding: 0.5rem; }
    th { background: #e3f2fd; }
    code { background: #f5f5f5; padding: 2px 4px; border-radius: 4px; }
    hr { margin: 2rem 0; }
  </style>
</head>
<body>
  <h1>FEDoc - Farming Game Engine Documentation</h1>

  <h2>Overview</h2>
  <p>
    Welcome to <strong>FEDoc</strong>, the official documentation for the Farming Game Engine built using <strong>Unreal Engine 5.6</strong> in <strong>C++</strong>.
  </p>
  <hr>

  <h2>Core Systems</h2>

  <h3>Inventory System</h3>
  <ul>
    <li><strong>InventoryComponent</strong>: Manages inventory logic including adding, removing, clearing, and item stacking. Fires events on inventory changes to update UI.</li>
    <li><strong>InventorySlot</strong>: Handles logic for item stacking and updating individual slots.</li>
    <li><strong>InventoryWidget / InventorySlotWidget</strong>: Provides visual representation and interactive UI for inventory management. Supports drag-and-drop item movement, <b>shift-drag splitting</b>, and quick access.</li>
  </ul>

  <h3>Player Character</h3>
  <ul>
    <li><strong>FarmerCharacter</strong>: Central pawn class for the player, integrating input handling for movement, interactions, harvesting, and combat. Utilizes <strong>StatsComponent</strong> for managing player attributes such as health and stamina.</li>
    <li><strong>FarmerController</strong>: Custom controller managing player input, camera systems, and interaction logic. <b>Handles all farming input (till, plant, harvest, crop selection)</b>.</li>
  </ul>

  <h3>Game Management</h3>
  <ul>
    <li><strong>GM_Farm</strong>: Core gameplay manager responsible for maintaining overall game state, including player spawning and initialization.</li>
  </ul>

  <h3>Items & Resources</h3>
  <ul>
    <li><strong>ItemData</strong>: Data-driven approach defining properties for each in-game item, such as icons, stack limits, and interactions.</li>
    <li><strong>DroppedItem / DroppedTreeLoot</strong>: Represents physical items spawned in-world, collectible by player interaction after harvesting or resource depletion. <b>DroppedItem</b> supports dynamic quantity for bulk drops.</li>
  </ul>

  <h3>Environment & Interaction</h3>
  <ul>
    <li><strong>TreeActor</strong>: Represents trees in-game, serving as harvestable resources. Implements the <code>DamageableInterface</code> to facilitate harvesting mechanics. <b>Supports custom drop amount and drop class via properties.</b></li>
    <li><strong>DamageableInterface</strong>: Standardized interface for destructible or interactive resources, streamlining interaction logic.</li>
  </ul>

  <h3>Player Stats & Damage</h3>
  <ul>
    <li><strong>StatsComponent</strong>: Manages player-specific attributes including health, stamina, damage calculation, and healing. Notifies relevant systems when stats change, enabling dynamic gameplay and UI updates.</li>
  </ul>
  <hr>

  <h2>Farming System (Crop & Grid)</h2>
  <p>
    The <b>Farming System</b> is fully <b>data-driven</b> and built around a grid of farm tiles managed by <code>AFarmManager</code>. All crop types are defined in a <b>DataTable</b> using the <code>FCropData</code> struct, allowing new crops to be added easily.
  </p>
  <h3>Key Classes & Structs</h3>
  <ul>
    <li>
      <b>AFarmManager</b> (<code>AActor</code>): Owns a <code>FFarmGrid*</code> and exposes <b>BlueprintCallable</b> functions:
      <ul>
        <li><code>TryTillAtWorld(FVector WorldPos)</code> &mdash; Till a tile at the given world position.</li>
        <li><code>TryPlantAtWorld(FVector WorldPos, FName CropRowName)</code> &mdash; Plant a crop (by RowName) at the position.</li>
        <li><code>TryHarvestAtWorld(FVector WorldPos)</code> &mdash; Harvest a ready crop at the position.</li>
        <li><code>CropDataTable</code> (settable in the editor) &mdash; DataTable of <code>FCropData</code> for all crop types.</li>
      </ul>
    </li>
    <li>
      <b>FFarmGrid</b>: Manages a 2D grid of <code>FFarmTileData</code> with per-tile logic.
      <ul>
        <li><code>GetTileAtWorldPos(FVector)</code>, <code>TryTillTile</code>, <code>PlantSeed</code>, <code>HarvestCrop</code>, <code>UpdateGrowth</code>.</li>
        <li>Uses <code>CropRowName</code> on each tile for lookups.</li>
      </ul>
    </li>
    <li>
      <b>FFarmTileData</b> (<code>USTRUCT</code>): Holds per-tile state.
      <ul>
        <li><code>bool bIsTilled</code> &mdash; Is this tile tilled?</li>
        <li><code>FName CropRowName</code> &mdash; DataTable row key of planted crop (empty if none).</li>
        <li><code>int32 GrowthStage</code>, <code>float GrowthTime</code> &mdash; Crop progress.</li>
        <li><code>bool bReadyToHarvest</code>, <code>bool bIsWatered</code>, <code>bool bIsFertilized</code>, <code>int32 CropQuality</code></li>
      </ul>
    </li>
    <li>
      <b>FCropData</b> (<code>USTRUCT</code>): Used as DataTable row struct.
      <ul>
        <li><code>FName RowName</code>, <code>FText DisplayName</code></li>
        <li><code>UTexture2D* Icon</code>, <code>UStaticMesh* Mesh</code> <em>(for visuals, not used yet)</em></li>
        <li><code>float TimeToGrow</code>, <code>int32 NumGrowthStages</code>, <code>int32 Yield</code></li>
      </ul>
    </li>
    <li>
      <b>AFarmerController</b> (<code>APlayerController</code>): Player input for farming.
      <ul>
        <li><code>TArray&lt;FName&gt; AvailableCropRows</code> &mdash; Populated from the CropDataTable.</li>
        <li><code>FName SelectedCropRowName</code> &mdash; Current crop for planting.</li>
        <li>
          Handles:
          <ul>
            <li>Left click: till or plant.</li>
            <li>Right click: harvest.</li>
            <li>NextCrop: cycles crop selection (by DataTable rows).</li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
  <h3>Farming Blueprint API</h3>
  <ul>
    <li><code>TryTillAtWorld(FVector WorldPos)</code> &mdash; Till tile at given location. Returns <code>bool</code>. (BlueprintCallable)</li>
    <li><code>TryPlantAtWorld(FVector WorldPos, FName CropRowName)</code> &mdash; Plant crop (by RowName) at location. Returns <code>bool</code>. (BlueprintCallable)</li>
    <li><code>TryHarvestAtWorld(FVector WorldPos)</code> &mdash; Harvest crop at location. Returns <code>bool</code>. (BlueprintCallable)</li>
    <li><code>CropDataTable</code> (AFarmManager, <code>EditAnywhere</code>) &mdash; Set this to your crop DataTable in the Details panel.</li>
    <li><code>AvailableCropRows</code> (AFarmerController, internal) &mdash; All valid crops, auto-populated from DataTable.</li>
    <li><code>SelectedCropRowName</code> (AFarmerController, internal) &mdash; The currently-selected crop for planting.</li>
  </ul>

  <h3>How the Farming System Works</h3>
  <ol>
    <li><b>Initialization</b>: AFarmManager is placed in the level, and <b>CropDataTable</b> is set in the Details panel. The grid is auto-initialized.</li>
    <li><b>Player Actions</b>:
      <ul>
        <li><b>Left Click</b>: Tills tile if not tilled; plants selected crop if tilled and empty.</li>
        <li><b>Right Click</b>: Harvests crop if ready.</li>
        <li><b>Next Crop</b>: Cycles the selection through all available DataTable crops.</li>
      </ul>
    </li>
    <li><b>Growth</b>: Each tick, AFarmManager calls <code>UpdateGrowth</code> on the grid. Crop tiles increment their growth time and stage. (To be upgraded to use per-crop DataTable values.)</li>
    <li><b>Harvest</b>: Harvested tiles reset, and future drops/yields will use the DataTable entry for that crop.</li>
    <li><b>Adding Crops</b>: To add a new crop, add a row to the DataTable asset (based on FCropData). All new crops show up automatically.</li>
  </ol>
  <h4><b>Note:</b> Visuals for icons and meshes are not yet used in gameplay but are exposed for future expansion.</h4>
  <hr>

  <h2>Class Reference</h2>
  <table>
    <tr>
      <th>Class Name</th>
      <th>Description</th>
    </tr>
    <tr><td><strong>FarmerCharacter</strong></td><td>Player pawn handling core gameplay mechanics.</td></tr>
    <tr><td><strong>FarmerController</strong></td><td>Handles input for farming, crop selection, and interactions.</td></tr>
    <tr><td><strong>GM_Farm</strong></td><td>GameMode handling game state and logic.</td></tr>
    <tr><td><strong>InventoryComponent</strong></td><td>Backend inventory management logic.</td></tr>
    <tr><td><strong>InventoryWidget</strong></td><td>Visual inventory UI for player interaction.</td></tr>
    <tr><td><strong>InventorySlotWidget</strong></td><td>UI representation for single inventory slots. Supports drag-and-drop and shift-drag for stack splitting.</td></tr>
    <tr><td><strong>ItemData</strong></td><td>Defines in-game item properties.</td></tr>
    <tr><td><strong>TreeActor</strong></td><td>Harvestable resource actor. Customizable drop amount and actor class. Supports Blueprint drop events.</td></tr>
    <tr><td><strong>DroppedItem</strong></td><td>Generic dropped collectible items, quantity can be set dynamically.</td></tr>
    <tr><td><strong>DroppedTreeLoot</strong></td><td>Specific loot from tree harvesting.</td></tr>
    <tr><td><strong>DamageableInterface</strong></td><td>Interface for destructible resources.</td></tr>
    <tr><td><strong>StatsComponent</strong></td><td>Manages player health, stamina, and effects.</td></tr>
    <tr><td><strong>FarmManager</strong></td><td>Owns the farm grid and the crop DataTable. Handles till/plant/harvest calls from player and updates growth.</td></tr>
    <tr><td><strong>FarmGrid</strong></td><td>Logic for a 2D array of farm tiles. All per-tile logic and world ↔ grid conversion.</td></tr>
    <tr><td><strong>FarmTileData</strong></td><td>Per-tile state struct: tilled, planted crop, growth, fertilized, watered, quality, etc.</td></tr>
    <tr><td><strong>CropData</strong></td><td>DataTable row struct: Display name, icon, mesh, growth time, stages, and yield for each crop.</td></tr>
  </table>
  <hr>

  <h2>Blueprint API</h2>
  <!-- Existing API... -->
  <h3>AFarmManager</h3>
  <ul>
    <li><code>TryTillAtWorld(FVector WorldPos)</code> &mdash; Till the tile at a given world position. <b>(BlueprintCallable)</b></li>
    <li><code>TryPlantAtWorld(FVector WorldPos, FName CropRowName)</code> &mdash; Plant crop by DataTable RowName. <b>(BlueprintCallable)</b></li>
    <li><code>TryHarvestAtWorld(FVector WorldPos)</code> &mdash; Harvest crop at world position. <b>(BlueprintCallable)</b></li>
    <li><code>CropDataTable</code> &mdash; Settable in editor. Assign your Crop DataTable (based on <code>FCropData</code>).</li>
  </ul>
  <h3>FCropData (DataTable Struct)</h3>
  <ul>
    <li><code>RowName</code> &mdash; DataTable key (automatically managed).</li>
    <li><code>DisplayName</code> &mdash; Name for UI.</li>
    <li><code>Icon</code> &mdash; Texture for UI (not used yet).</li>
    <li><code>Mesh</code> &mdash; Static mesh for visuals (not used yet).</li>
    <li><code>TimeToGrow</code> &mdash; Seconds to fully grow.</li>
    <li><code>NumGrowthStages</code> &mdash; Number of visual/logic growth stages.</li>
    <li><code>Yield</code> &mdash; Amount produced per harvest.</li>
  </ul>
  <hr>

  <h2>Workflow</h2>
  <h3>Farming</h3>
  <ol>
    <li>Player clicks a tile with left mouse: if not tilled, tills it; if tilled, plants selected crop (using DataTable row name).</li>
    <li>Right click: harvests crop if ready.</li>
    <li>Tick: crop growth is updated, progressing toward harvestable state using tile and DataTable data.</li>
    <li>Adding new crops: add a row in your CropDataTable (icon and mesh fields ready for future use).</li>
  </ol>
  <h3>Inventory Management</h3>
  <ul>
    <li>Collect item &rarr; Spawn as <code>DroppedItem</code> &rarr; Player overlap &rarr; Added to <code>InventoryComponent</code> &rarr; UI (<code>InventoryWidget</code>) updated automatically. DroppedItem actor destroys itself on pickup success.</li>
    <li><b>Shift+Drag</b> inventory slot to split stack: drag half the stack to another slot, supporting intuitive stack management.</li>
  </ul>
  <h3>Resource Harvesting</h3>
  <ul>
    <li>Interact with <code>TreeActor</code> &rarr; Apply damage via <code>DamageableInterface</code> &rarr; Resource depleted &rarr; Spawn <code>DroppedItem</code> (logs, variable amount) &rarr; Collect loot &rarr; Inventory updated.</li>
  </ul>
  <h3>Player Stats Interaction</h3>
  <ul>
    <li>Player actions modify <code>StatsComponent</code> &rarr; Health/Stamina updated &rarr; UI and gameplay reflect changes dynamically.</li>
  </ul>
  <hr>

  <h2>Roadmap</h2>
  <ul>
    <li><b>Complete crop DataTable integration in growth logic.</b></li>
    <li>Crafting system.</li>
    <li>Additional resource types (rocks, minerals).</li>
    <li>Advanced combat mechanics with enemy AI.</li>
    <li>UI/UX improvements with polished interactions.</li>
    <li>Comprehensive audio integration (environment, actions, feedback).</li>
  </ul>
  <hr>

  <h2>Contributing</h2>
  <p>
    Fork the repository on GitHub, create a feature branch, and submit a pull request with your changes.
  </p>
  <hr>
  <p><em>Last updated: July 31, 2025</em></p>
</body>
</html>
