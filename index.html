<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Eryndor — Dev Quick Reference (nav v2)</title>
<style>
:root{ --bg:#0f141a; --fg:#e6edf3; --muted:#9aa4af; --line:#293241; --primary:#64b5f6; --pri-2:#90caf9; --chip:#082032; --chip-fg:#90caf9; --card:#111827; --kbd-bg:#1f2937; }
*{ box-sizing:border-box } body{ margin:0; background:var(--bg); color:var(--fg); font: 15px/1.5 -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,system-ui; }
header{ display:flex; align-items:center; gap:.75rem; padding:.75rem 1rem; border-bottom:1px solid var(--line); position:sticky; top:0; background:rgba(15,20,26,.9); backdrop-filter:saturate(1.2) blur(6px); z-index:50 }
.logo{ font-weight:700; letter-spacing:.4px; }
.logo small{ display:block; color:var(--muted); font-weight:500; letter-spacing:.2px; }
.container{ display:grid; grid-template-columns: 300px 1fr; min-height:calc(100vh - 56px) }
aside{ border-right:1px solid var(--line); padding:1rem; position:sticky; top:56px; height:calc(100vh - 56px); overflow:auto }
main{ padding:1rem 2rem; scroll-behavior:smooth; }
.search{ display:flex; gap:.5rem; margin-bottom:.5rem }
.search input{ flex:1; padding:.5rem .75rem; border:1px solid var(--line); border-radius:8px; background:var(--bg); color:var(--fg) }
.section h2{ color:var(--pri-2); border-bottom:1px solid var(--line); padding-bottom:.25rem }
.card{ background:var(--card); border:1px solid var(--line); border-radius:12px; padding:0; margin:1rem 0; overflow:hidden }
.card .card-hdr{ padding:.75rem 1rem; display:flex; align-items:baseline; gap:.75rem; border-bottom:1px solid var(--line) }
.card .meta{ padding:.5rem 1rem; display:flex; gap:1rem; flex-wrap:wrap; border-bottom:1px dashed var(--line) }
.tbl{ width:100%; border-collapse:collapse; } .tbl th,.tbl td{ border-top:1px solid var(--line); padding:.5rem .6rem; text-align:left; vertical-align:top; }
.badge{ display:inline-flex; align-items:center; gap:.25rem; padding:.15rem .45rem; background:var(--chip); color:var(--chip-fg); border-radius:999px; font-size:.75rem; border:1px solid var(--line) }
.err{ background:#5b1a1a; color:#ffdada; padding:.5rem 1rem; border-bottom:1px solid #7a2b2b; position:sticky; top:56px; z-index:60 }
.toc a{ display:block; padding:.25rem .25rem; border-radius:6px; color:var(--fg); text-decoration:none }
.toc a:hover{ background:#1c2530; }
.muted{ color:var(--muted) }
.kv{ display:flex; gap:.5rem; flex-wrap:wrap }
.kv div{ background:var(--kbd-bg); border:1px solid var(--line); padding:.15rem .5rem; border-radius:6px; font-size:.8rem }
hr.sep{ border:0; border-top:1px dashed var(--line); margin:.5rem 0 }
</style>
</head>
<body>
<header>
  <div class="logo">
    FINAL BUILD GAMES
    <small>Eryndor — Dev Quick Reference</small>
  </div>
  <div class="muted">Snapshot: 2025-08-31</div>
</header>
<div id="err" class="err" style="display:none"></div>
<div class="container">
  <aside>
    <div class="search"><input id="q" type="search" placeholder="Search (press / to focus)" /></div>
    <div class="toc"><h3>Contents</h3><div id="toc"></div></div>
    <div class="muted" style="font-size:.85rem;margin-top:.5rem">Tip: Press <kbd>/</kbd> to jump to search.</div>
    <hr class="sep" />
    <div class="muted" style="font-size:.85rem">This page is static. Update the DATA block to refresh symbols.</div>
  </aside>
  <main>
    <div class="section" id="singletons"><h2>Singletons (Autoload)</h2></div>
    <div class="section" id="ui"><h2>UI Scenes / Scripts</h2></div>
    <div class="section" id="other"><h2>Other Scripts</h2></div>
  </main>
</div>
<script>
"use strict";
(function(){
  // ---------------------------------------------------------------------------
  // DATA: Update this block when the project changes.
  // ---------------------------------------------------------------------------
  const DATA = {
    project: { name: "Eryndor", org: "Final Build Games", snapshot: "2025-08-31" },
    singletons: [
      {
        name: "Economy",
        anchor: "Autoload_Economy",
        path: "Autoload/Economy.gd",
        class_name: "Economy",
        extends: "Node",
        signals: [{ name: "purchase_made", args: "kind:String, units:int, cost:int" }],
        exports: [{ name: "wood_price", type: "int" }, { name: "metal_price", type: "int" }],
        public: [
          { name: "balance", ret: "int", args: "" },
          { name: "get_unit_price", ret: "int", args: "resource:String" },
          { name: "estimate_buy_cost", ret: "int", args: "resource:String, amount:int" },
          { name: "can_afford", ret: "bool", args: "amount:int" },
          { name: "earn_gold", ret: "void", args: "amount:int, reason:String=\"\"" },
          { name: "spend_gold", ret: "bool", args: "amount:int, reason:String=\"\"" },
          { name: "buy", ret: "bool", args: "resource:String, amount:int" },
          { name: "weapon_craft_cost", ret: "Dictionary", args: "" },
          { name: "armor_craft_cost", ret: "Dictionary", args: "" },
          { name: "can_craft", ret: "bool", args: "cost:Dictionary" },
          { name: "try_consume_for_craft", ret: "bool", args: "cost:Dictionary, label:String" }
        ],
        internal: []
      }
      // Note: GameState omitted because it wasn't present in the uploaded zip snapshot.
    ],
    ui: [
      {
        name: "UI_EconomyTest",
        anchor: "UI_UI_EconomyTest",
        path: "User Interface/economy_test.gd",
        class_name: "UI_EconomyTest",
        extends: "Control",
        public: [],
        internal: [
          { name: "_ready", ret: "void", args: "" },
          { name: "_on_res_changed", ret: "void", args: "s:Dictionary" },
          { name: "_on_day_changed", ret: "void", args: "d:int" },
          { name: "_on_tx", ret: "void", args: "entry:Dictionary" },
          { name: "_on_purchase", ret: "void", args: "kind:String, units:int, cost:int" },
          { name: "_on_earn10", ret: "void", args: "" },
          { name: "_on_spend50", ret: "void", args: "" },
          { name: "_on_buy_wood", ret: "void", args: "" },
          { name: "_on_buy_metal", ret: "void", args: "" },
          { name: "_on_craft_weapon", ret: "void", args: "" },
          { name: "_on_craft_armor", ret: "void", args: "" },
          { name: "_on_next_day", ret: "void", args: "" },
          { name: "_refresh_prices", ret: "void", args: "" },
          { name: "_cost_text", ret: "String", args: "cost:Dictionary" },
          { name: "_append_log", ret: "void", args: "line:String" }
        ]
      }
    ],
    other: [
      // Add additional scripts here as they appear in the repo.
    ]
  };

  // ---------------------------------------------------------------------------
  // Utilities
  // ---------------------------------------------------------------------------
  const $ = (s,root=document)=>root.querySelector(s);
  const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));
  const err = document.getElementById('err');
  function showErr(msg){ err.textContent = msg; err.style.display='block'; console.error(msg); }
  function ensureArray(v){ if(Array.isArray(v)) return v; if(typeof v==='string' && v.length) return v.split(',').map(s=>s.trim()).filter(Boolean); return []; }
  function makeTable(headings){
    const tbl = document.createElement('table'); tbl.className='tbl';
    const thead = document.createElement('thead'); const tr = document.createElement('tr');
    headings.forEach(h=>{ const th = document.createElement('th'); th.textContent=h; tr.appendChild(th); });
    thead.appendChild(tr); tbl.appendChild(thead);
    const tbody = document.createElement('tbody'); tbl.appendChild(tbody);
    return [tbl, tbody];
  }
  function addTOC(container, anchor, text){
    const a = document.createElement('a'); a.href = '#'+anchor; a.textContent = text;
    container.appendChild(a);
  }

  // ---------------------------------------------------------------------------
  // Renderers
  // ---------------------------------------------------------------------------
  function renderScriptCard(targetSection, s, kindIcon, kindLabel){
    const anchor = s.anchor || s.name;
    const card = document.createElement('div'); card.className='card'; card.id = anchor;
    const hdr = document.createElement('div'); hdr.className='card-hdr';
    hdr.innerHTML = `<h3>${kindIcon} ${s.name}</h3> <span class="muted">${s.path || ''}</span>`;
    card.appendChild(hdr);

    const meta = document.createElement('div'); meta.className='meta';
    const bits = [];
    if(s.class_name) bits.push(`<div><strong>class_name</strong>: <code>${s.class_name}</code></div>`);
    if(s.extends) bits.push(`<div><strong>extends</strong>: <code>${s.extends}</code></div>`);
    if(s.signals && s.signals.length){
      bits.push(`<div><strong>signals</strong>: <code>${s.signals.map(x=>x.name).join(', ')}</code></div>`);
    }
    if(s.exports && s.exports.length){
      bits.push(`<div><strong>exports</strong>: <code>${s.exports.map(x=>`${x.name}:${x.type}`).join(', ')}</code></div>`);
    }
    meta.innerHTML = bits.join(''); card.appendChild(meta);

    if(s.public && s.public.length){
      const [tbl, body] = makeTable(['Public Method','Signature']);
      s.public.forEach(f=>{
        const sig = `${f.ret || 'void'} ${f.name}(${f.args||''})`;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><code>${f.name}</code></td><td><code>${sig}</code></td>`;
        body.appendChild(tr);
      });
      card.appendChild(tbl);
    }

    if(s.internal && s.internal.length){
      const [tbl, body] = makeTable(['Internal Method','Signature']);
      s.internal.forEach(f=>{
        const sig = `${f.ret || 'void'} ${f.name}(${f.args||''})`;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><code>${f.name}</code></td><td><code>${sig}</code></td>`;
        body.appendChild(tr);
      });
      card.appendChild(tbl);
    }

    targetSection.appendChild(card);
    addTOC(document.getElementById('toc'), anchor, `${kindLabel}: ${s.name}`);
  }

  // ---------------------------------------------------------------------------
  // Boot
  // ---------------------------------------------------------------------------
  try{
    const secSingletons = document.getElementById('singletons');
    const secUI = document.getElementById('ui');
    const secOther = document.getElementById('other');
    const toc = document.getElementById('toc');
    const q = document.getElementById('q');

    document.addEventListener('keydown', (e)=>{ if(e.key==='/'){ e.preventDefault(); q && q.focus(); }});

    ensureArray(DATA.singletons).forEach(s=>renderScriptCard(secSingletons, s, '⚒️', 'Singleton'));
    ensureArray(DATA.ui).forEach(s=>renderScriptCard(secUI, s, '📜', 'UI'));
    ensureArray(DATA.other).forEach(s=>renderScriptCard(secOther, s, '📄', 'Script'));

    // Live search filter
    function applyFilter(txt){
      const ql = (txt||'').toLowerCase();
      const cards = $$('.card');
      cards.forEach(c=>{
        const hit = c.textContent.toLowerCase().includes(ql);
        c.style.display = hit ? '' : 'none';
      });
      const anchors = Array.from(toc.querySelectorAll('a'));
      anchors.forEach(a=>{
        const t = a.textContent.toLowerCase();
        const target = document.querySelector(a.getAttribute('href'));
        const visible = !!target && target.style.display !== 'none';
        a.style.display = (!ql || t.includes(ql)) && visible ? '' : 'none';
      });
    }
    if(q){ q.addEventListener('input', ()=>applyFilter(q.value)); }

    if(!(DATA.singletons && DATA.singletons.length) && !(DATA.ui && DATA.ui.length) && !(DATA.other && DATA.other.length)){
      showErr('No parsed symbols found. Update the DATA block to include your scripts.');
    }
  } catch(e){
    showErr('Render error: ' + (e && e.message ? e.message : String(e)));
  }
})();
</script>
</body>
</html>
